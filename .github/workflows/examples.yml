on:
  push:
    branches:
      - main
    paths:
      - .github/**
      - examples/**
      - '!README.md'

env:
  MAIN_BRANCH_URL: "https://raw.githubusercontent.com/liquidcarbon/puppy/main/"
  PYTHONIOENCODING: "utf8"  # https://github.com/pallets/click/issues/2121

jobs:
  bash-generate-notebooks:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@v4
    - name: Install puppy3.12
      run: cat pup.sh | bash -s 3.12
    - name: Install jupyter
      run: source ~/.bash_profile && pixi add notebook nbclient
    - name: Run notebook demo
      run: examples/Q-strings/demo.sh
  
  windows-gradio:
    runs-on: windows-latest
    steps:
    - name: Install puppy3.11
      run: |
        & ([scriptblock]::Create((iwr -useb $env:MAIN_BRANCH_URL/pup.ps1).Content)) 3.11
    - name: Create alias and run a pup command
      run: |
        iex ((iwr $env:MAIN_BRANCH_URL/pup.ps1).Content -split "`n")[-2] ; pup fetch zero-to-gradio gradio
    - name: Start app
      run: >
        zero-to-gradio\.venv\Scripts\python.exe -c
        'import gradio as gr; gr.Interface(lambda x: x, inputs=["text"], outputs=["text"]).launch(prevent_thread_lock=1)'
